
#include "protheus.ch"
#include "topconn.ch"

/*
√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú
¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±
¬±¬±√â√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ë√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ã√ù√ù√ù√ù√ù√ù√ù√ë√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ã√ù√ù√ù√ù√ù√ù√ë√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù¬ª¬±¬±
¬±¬±¬∫Programa  ¬≥DCOMA001  ¬∫Autor  ¬≥Marco Aurelio       ¬∫ Data ¬≥  10-08-16   ¬∫¬±¬±
¬±¬±√å√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ò√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ä√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ä√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù¬π¬±¬±
¬±¬±¬∫Desc.     ¬≥  Importar tabela de pre√ßos de Compras                      ¬∫¬±¬±
¬±¬±¬∫          ¬≥                                                            ¬∫¬±¬±
¬±¬±√å√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ò√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù¬π¬±¬±
¬±¬±¬∫Uso       ¬≥ AP                                                         ¬∫¬±¬±
¬±¬±√à√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù¬º¬±¬±
¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±
√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü
*/

*----------------------------------------*
User Function DCOMA001()
	*----------------------------------------*
	local oDlg
	local bCancel 	:= {|| oDlg:End()}
	local bOK    	:= {|| If(CSB03Grava(), oDlg:End(),)}
	local oRadio
	Private cCodFOR	:= AIA->AIA_CODFOR
	Private cLojFOR	:= AIA->AIA_LOJFOR
	Private cTabela := AIA->AIA_CODTAB
	Private	cItem   := "0000"

	private cNom_Arq := ''
	private nRadio   := 1

	If MsgYesNo('Deseja Atualizar a Tabela ' + cTabela + ' do Fornecedor '+cCodFOR + '-' +cLojFOR+' ?')  // Tratado

		Begin sequence

			cNom_Arq :=Upper(Alltrim(cGetFile("Arquivos *.CSV|*.CSV","Selecione o arquivo para importa√ß√£o.")))

			If !File(cNom_Arq).and. empty(cNom_Arq)
				Aviso('Aten√ß√£o','N√£o encontrado o arquivo com a tabela do fornecedor',{'OK'})
				break
			EndIf

			Define MsDialog oDlg title 'Importando tabelas de Pre√ßo' from 0,0 to 300,400 pixel

			@ 013,002 to 78,250 label 'Tabela de Preco' of oDlg pixel
			@ 030,010 say '  Tabela a ser Importada: ' size 65,10 of oDlg pixel
			@ 080,010 radio oRadio var nRadio Items ;
			    'Tabela de preco em Real   (R$)'  ,;
				'Tabela de preco em Dolar  (US$)' ,;
				'Tabela de preco em Franco (CHF)' ,;
				'Tabela de preco em Peso   (CLP)' ,;
				'Tabela de preco em Euro   (Ä)'   3D size 120,10 of oDlg pixel

				/*
				 2   DOLAR
                 3   FRANCO
                 4   PESO CHILENO
                 5   EURO SÌmbolo do Euro (Ä) - Significados
				*/

			Activate MsDialog oDlg Center On Init EnchoiceBar(oDlg,bok,bcancel)

		End Sequence
		Msgalert ('Processado '+  cItem +' Itens')
	endif

return

	*-------------------------------------------*
Static Function CSB03Grava()
	*-------------------------------------------*

	local lRetorno := .t.

	if !CSB01Exist(cTabela)
		lRetorno := .f.
	endIf

	//Limpa tabela de preco para nova importa√ß√£o
	//Processa({|| CSB03LimpaTab(cTabela) } )

	IF !Empty(cNom_Arq)
		nHandle	 := FT_FUSE(cNom_Arq)
		Processa( {|lEnd| LeArq(cTabela) } , "Lendo Arquivo...")
		FClose(nHandle)
	EndIF

Return(.T.)


	*-------------------------------------------*
Static Function CSB01Exist(cTabela)
	*-------------------------------------------*
	local lRetorno := .t.

	AIA->(DbsetOrder(1))

	If AIA->(!DbSeek(xFilial('AIA') + cCodFOR+cLojFOR+cTabela))
		Aviso('Aten√ß√£o','Codigo de tabela de pre√ßos ' + cTabela + 'n√£o encontrado no cadastro de tabelas de pre√ßos!',{'Ok'})
		lRetorno := .f.
	EndIf

return(lRetorno)



/*
√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú
¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±
¬±¬±√â√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ë√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ã√ù√ù√ù√ù√ù√ù√ù√ë√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ã√ù√ù√ù√ù√ù√ù√ë√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù¬ª¬±¬±
¬±¬±¬∫Programa  ¬≥CSB03LimpaTab  ¬∫Autor  ¬≥Eduardo Patriani    ¬∫ Data ¬≥  10/04/08   ¬∫¬±¬±
¬±¬±√å√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ò√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ä√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ä√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù¬π¬±¬±
¬±¬±¬∫Desc.     ¬≥ Limpa Tabela de Preco                                      	    ¬∫¬±¬±
¬±¬±√å√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ò√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù¬π¬±¬±
¬±¬±¬∫Uso       ¬≥ Control Service                                           	    ¬∫¬±¬±
¬±¬±√à√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù√ù¬º¬±¬±
¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±
√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü
*/

Static Function CSB03LimpaTab(cTabela)


	DbSelectArea("AIB")
	DbSetOrder(1)
	ProcRegua( Reccount() )
	DbSeek(xFilial("AIB") + cCodFOR+cLojFOR+cTabela , .T. )
	Do While !Eof() .And. ( AIB->(AIB_FILIAL+AIB_CODFOR+AIB_LOJFOR+AIB_CODTAB) == xFilial("AIB")+cCodFOR+cLojFOR+cTabela     )
		IncProc()
		RecLock("AIB",.F.)
		DbDelete()
		MsUnlock()
		DbSelectArea("AIB")
		Dbskip()
	Enddo

Return(Nil)


/*
√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú√ú
¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±
¬±¬±√ö√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ç√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ç√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ç√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ç√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ç√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ¬ø¬±¬±
¬±¬±¬≥Fun‚Ä°‚Ä¶o    ¬≥ LeArq    ¬≥ Autor ¬≥  Eduardo Patriani     ¬≥ Data ¬≥ 24/04/08 ¬≥¬±¬±
¬±¬±√É√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ö√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√ù√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√ù√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√ù√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√ù√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ¬¥¬±¬±
¬±¬±¬≥Descri‚Ä°‚Ä¶o ¬≥ Importa dados.                                             ¬≥¬±¬±
¬±¬±√Ä√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√ù√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√ô¬±¬±
¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±¬±
√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü√ü
*/

Static Function LeArq(cTabela)

	Local nX :=0
	Local cBuffer
	Local aAux      := {}
	Local lContinua := .T.
	Private aTabP 	 := {}

	FT_FGOTOP()
	ProcRegua(FT_FLASTREC())

	While ! FT_FEOF()

		//√ö√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ¬ø
		//¬≥ Leitura do arquivo texto.                                      ¬≥
		//√Ä√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√ô
		cBuffer := FT_FREADLN()
		aAux    := U_Str2Array(cBuffer,";")
		AAdd( aTabP , aAux)

		IncProc()
		FT_FSKIP(1)
	EndDo

	lContinua := ValidaVetor()


	IF Len(aTabP) > 0 .and. lContinua


		//Limpa tabela de preco para nova importa√ß√£o
		Processa({|| CSB03LimpaTab(cTabela) } )

		cItem := "0000"
		For nX := 2 To Len(aTabP)	// Comeca com 2 para ignorar primeira linha com cabecalho.
			IF SUBSTR(aTabP[nX,1],1,6)==cCodFOR .AND.  SUBSTR(aTabP[nX,1],8,2)== cLojFOR//000000/00

				DbSelectArea("AIB")
				DbSetOrder(1)
				RecLock("AIB",.T.)

				cItem := Soma1(cItem,Len(AIB->AIB_ITEM))
				AIB->AIB_FILIAL := xFilial("AIB")
				AIB->AIB_CODFOR := cCodFOR
				AIB->AIB_LOJFOR := cLojFOR
				AIB->AIB_CODTAB := cTabela
				AIB->AIB_ITEM   := cItem //strzero(cItem,4) //MAX_DA1(cTabela)
				AIB->AIB_CODPRO := aTabP[nX,2]
				AIB->AIB_PRCCOM := val(StrTran(aTabP[nX,6],",",".")) //val(aTabP[nX,6])    //	StrTran(_cPAR02, ",", ".", 1, 1)
				AIB->AIB_QTDLOT := 999999.99
				AIB->AIB_INDLOT := "000000000999999.99"
				AIB->AIB_MOEDA  := nRadio //1
				AIB->AIB_DATVIG := dDataBase
				AIB->AIB_FRETE  := 0

				Msunlock()
			ENDIF

		Next nX


		//√ö√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ¬ø
		//¬≥Atualiza Amarracao  Produto x Fornecedor¬≥
		//√Ä√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√Ñ√ô

		For nX := 2 To Len(aTabP)	// Comeca com 2 para ignorar primeira linha com cabecalho.
			IF SUBSTR(aTabP[nX,1],1,6)==cCodFOR .AND.  SUBSTR(aTabP[nX,1],8,2)== cLojFOR//000000/00

				DbSelectArea("SA5")
				SA5->(dbSetOrder(1))
				If SA5->(!dbSeek(xFilial("SA5") + cCodFOR + cLojFOR + aTabP[nX,2]))

					RecLock("SA5",.T.)

					SA5->A5_FILIAL		:= xFilial("SA5")
					SA5->A5_FORNECE	:=	cCodFOR
					SA5->A5_LOJA		:=	cLojFOR
					SA5->A5_FABR		:=	cCodFOR
					SA5->A5_NOMEFOR	:= Alltrim(Posicione("SA2",1,xFilial("SA2") + cCodFOR + cLojFOR,"A2_NOME"))
					SA5->A5_PRODUTO	:=	aTabP[nX,2]
					SA5->A5_NOMPROD	:= Posicione("SB1",1,xFilial("SB1")+aTabP[nX,2],"B1_DESC")
					SA5->A5_DESCPRF	:=	Posicione("SB1",1,xFilial("SB1")+aTabP[nX,2],"B1_DESC")
					SA5->A5_CODTAB		:=	cTabela

					Msunlock()
				else
					//	     	if  SA5->A5_CODTAB <> cTabela
					RecLock("SA5",.F.)
					//					SA5->A5_FILIAL		:= xFilial("SA5")
					SA5->A5_FORNECE	:=	cCodFOR
					SA5->A5_LOJA		:=	cLojFOR
					SA5->A5_FABR		:=	cCodFOR
					SA5->A5_NOMEFOR	:= Alltrim(Posicione("SA2",1,xFilial("SA2") + cCodFOR + cLojFOR,"A2_NOME"))
					SA5->A5_PRODUTO	:=	aTabP[nX,2]
					SA5->A5_NOMPROD	:= Posicione("SB1",1,xFilial("SB1")+aTabP[nX,2],"B1_DESC")
					SA5->A5_DESCPRF	:=	Posicione("SB1",1,xFilial("SB1")+aTabP[nX,2],"B1_DESC")
					SA5->A5_CODTAB		:=	cTabela
					Msunlock()
					//	   	endif
				Endif
			ENDIF
		Next nX

	EndIF

Return(Nil)




Static Function ValidaVetor()
	local  nX:=0
	Local _Retorno := .T.

	SB1->( dbSetOrder(1) )

	For nX := 2 To Len(aTabP)

		IF SUBSTR(aTabP[nX,1],1,6)==cCodFOR .AND.  SUBSTR(aTabP[nX,1],8,2)== cLojFOR//000000/00

			If ! (SB1->( dbSeek( xFilial() + aTabP[nx,2] ) ))
				MsgStop("Produto informado da linha " + Alltrim(Str(nX)) + " n√£o localizado no Cadastro de Produtos. " + Chr(13) + "A importa√ß√£o n√£o ser√° realizada. " )
				_Retorno := .F.
			endif
		ENDIF

	Next nX

Return _Retorno
